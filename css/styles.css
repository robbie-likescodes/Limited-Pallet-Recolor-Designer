/* =========================================
   Palette Mapper â€” High-contrast UI styles
   ========================================= */

/* ---------- Design Tokens ---------- */
:root{
  /* Surfaces */
  --bg:        #0a1020; /* page */
  --bg-grad-1: #16264d;
  --bg-grad-2: #0a1020;

  --card:      #0f1a34; /* cards/panels */
  --card-2:    #0c1630; /* darker inner */
  --card-b:    #2b3c61; /* borders */

  /* Text */
  --text:      #f3f6fc; /* primary */
  --text-2:    #c7d2e6; /* secondary */
  --text-3:    #9db0cf; /* tertiary */
  --text-inv:  #0b1222;

  /* Accents */
  --brand:     #4f8cff;
  --brand-600: #3879ff;
  --brand-700: #2d67e8;

  --ghost:     #1d2842; /* neutral button */
  --ghost-b:   #304369;

  --danger:    #ff5c5c;
  --danger-700:#d83e3e;

  --ok:        #4ade80;
  --warn:      #f59e0b;

  /* Controls */
  --focus:     #7fb1ff;
  --input:     #0e1a33;
  --input-b:   #2a3a5e;
  --input-b2:  #3a4c76;

  /* Misc */
  --shadow:    0 18px 55px rgba(0,0,0,.35);
  --inner:     inset 0 1px 0 rgba(255,255,255,.03);
  --radius-lg: 16px;
  --radius:    12px;
  --radius-sm: 9px;

  /* Swatch outline */
  --sw-outline:#3b4d72;

  /* Range tracks */
  --track:     #20345c;
  --track-b:   #31476f;
}

/* High-contrast auto for users preferring it */
@media (prefers-contrast: more){
  :root{
    --text: #ffffff;
    --text-2:#dbe7ff;
    --card-b:#4a67a4;
  }
}

/* ---------- Base ---------- */
*{ box-sizing: border-box; }
html, body { height:100%; }
html { -webkit-text-size-adjust:100%; }
body{
  margin:0;
  background:
    radial-gradient(1200px 1200px at 50% -240px, var(--bg-grad-1) 0%, var(--bg-grad-2) 45%) fixed,
    var(--bg);
  color:var(--text);
  font: 16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  text-rendering: optimizeLegibility;
}

h1,h2,h3{ margin:0 0 10px; line-height:1.2; }
h1{ font-size: clamp(26px, 3.2vw, 34px); letter-spacing:.2px; }
h2{ font-size: clamp(20px, 2.3vw, 24px); color: var(--text); }
h3{ font-size: 15px; color: var(--text-2); font-weight: 700; letter-spacing:.2px; }

.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
a{ color: var(--brand); text-decoration: none; }
a:hover{ text-decoration: underline; }

/* ---------- Header ---------- */
header{
  display:flex; align-items:center; justify-content:space-between;
  padding: 22px clamp(14px, 3vw, 24px);
}
header p{ margin:6px 0 0; color: var(--text-2); }

/* ---------- Layout helpers ---------- */
main{ padding: 0 clamp(14px, 3vw, 24px) 28px; }
.row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.row .grow{ flex:1; }
.help{ color: var(--text-3); margin: 8px 0 2px; }
.tiny-help{ color: var(--text-3); font-size: 12px; }

/* ---------- Cards / Panels ---------- */
.card{
  background: linear-gradient(180deg, rgba(24,34,56,.66), rgba(10,16,32,.78));
  border: 1px solid var(--card-b);
  border-radius: var(--radius-lg);
  padding: clamp(14px, 2.2vw, 20px);
  margin: 0 auto 18px;
  box-shadow: var(--shadow), var(--inner);
}

.panel{
  margin-top:10px;
  padding: 10px;
  background: var(--card-2);
  border: 1px solid var(--card-b);
  border-radius: var(--radius);
}
.panel-head{
  margin: -6px -6px 10px -6px;
  padding: 10px 12px;
  background: #122143;
  border-radius: var(--radius-sm);
  border: 1px solid var(--card-b);
  font-weight: 800;
  color: var(--text-2);
  letter-spacing:.2px;
}

/* ---------- Buttons ---------- */
.btn{
  appearance:none;
  border: 1px solid transparent;
  background: var(--brand);
  color: #fff;
  padding: 11px 16px;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: transform .02s ease, background .16s ease, border-color .16s ease, box-shadow .16s ease;
  box-shadow: 0 8px 24px rgba(79,140,255,.22);
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}
.btn:hover{ background: var(--brand-600); }
.btn:active{ transform: translateY(1px); }
.btn[disabled]{ opacity:.6; cursor:not-allowed; box-shadow:none; }

.btn-ghost{
  background: var(--ghost);
  color: var(--text);
  border-color: var(--ghost-b);
  box-shadow: none;
}
.btn-ghost:hover{ background: #233357; }

.btn-danger{
  background: var(--danger);
  border-color: var(--danger);
  color: #fff;
  box-shadow: 0 8px 24px rgba(255,92,92,.22);
}
.btn-danger:hover{ background: var(--danger-700); }

/* File inputs as buttons */
.picker{ position:relative; display:inline-flex; align-items:center; justify-content:center; }
.picker input[type=file]{ position:absolute; inset:0; opacity:0; appearance:none; cursor:pointer; }

/* ---------- Forms (greatly improved contrast) ---------- */
input[type="number"],
input[type="text"],
select{
  background: var(--input);
  color: var(--text);
  border: 1px solid var(--input-b);
  border-radius: 10px;
  padding: 10px 12px;
  min-width: 92px;
  outline: none;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);
}
input[type="number"]::placeholder,
input[type="text"]::placeholder{ color: #9fb0cfaa; }

input[type="number"]:focus,
input[type="text"]:focus,
select:focus{
  border-color: var(--focus);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--focus) 30%, transparent);
}

/* Checkboxes */
input[type="checkbox"]{
  width: 18px; height: 18px;
  accent-color: var(--brand);
  filter: drop-shadow(0 0 0 rgba(0,0,0,0));
}

/* Key/Value inline labels */
.kv{ display:flex; align-items:center; gap:10px; }
.kv .key{ color: var(--text-2); }

/* ---------- Range sliders (with spectrum option) ---------- */
input[type="range"]{
  -webkit-appearance:none; appearance:none;
  width: 220px; height: 30px; background: transparent;
}
input[type="range"]::-webkit-slider-runnable-track{
  height: 8px; border-radius: 5px;
  background: linear-gradient(180deg, var(--track), #1b2b4f);
  border: 1px solid var(--track-b);
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none; margin-top:-8px;
  width: 22px; height: 22px; border-radius: 50%;
  background: #fff; border: 2px solid var(--brand);
  box-shadow: 0 2px 10px rgba(0,0,0,.35), 0 0 0 3px rgba(79,140,255,.20) inset;
}
input[type="range"]::-moz-range-track{
  height: 8px; border-radius: 5px;
  background: linear-gradient(180deg, var(--track), #1b2b4f);
  border: 1px solid var(--track-b);
}
input[type="range"]::-moz-range-thumb{
  width: 20px; height: 20px; border-radius: 50%;
  background: #fff; border: 2px solid var(--brand);
  box-shadow: 0 2px 10px rgba(0,0,0,.35), 0 0 0 3px rgba(79,140,255,.20) inset;
}

/* Spectrum track (use on sliders tied to colors): add class="spectrum" on the range input */
input[type="range"].spectrum::-webkit-slider-runnable-track{
  background: linear-gradient(90deg,
    #ff0000 0%, #ffff00 16.6%, #00ff00 33.3%, #00ffff 50%,
    #0000ff 66.6%, #ff00ff 83.3%, #ff0000 100%);
  border: 1px solid #2e3f69;
}
input[type="range"].spectrum::-moz-range-track{
  background: linear-gradient(90deg,
    #ff0000 0%, #ffff00 16.6%, #00ff00 33.3%, #00ffff 50%,
    #0000ff 66.6%, #ff00ff 83.3%, #ff0000 100%);
  border: 1px solid #2e3f69;
}

/* ---------- Color pickers & swatches ---------- */
/* Make native color inputs large and legible */
input[type="color"]{
  width: 48px; height: 38px; padding: 0;
  background: var(--input);
  border: 1px solid var(--input-b);
  border-radius: 9px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
}
input[type="color"]::-webkit-color-swatch-wrapper{ padding:0; }
input[type="color"]::-webkit-color-swatch{
  border: 1px solid var(--sw-outline);
  border-radius: 8px;
}

/* Swatch rows (used in Working Palette) */
.inline-swatches .sw,
.swatch-row .sw{
  display:inline-block;
  width: 22px; height: 22px;
  border-radius: 6px;
  border: 1px solid var(--sw-outline);
}
.swatch-row{
  display:flex; align-items:center; gap:10px; flex-wrap:wrap;
}

/* Optional popover for future color tools (JS can toggle .open) */
.popover{
  display:none;
  position:absolute; z-index:99999;
  background: #0e1832;
  border: 1px solid var(--card-b);
  border-radius: 12px;
  padding: 10px;
  box-shadow: 0 18px 55px rgba(0,0,0,.45);
  color: var(--text);
}
.popover.open{ display:block; }

/* ---------- Palette editor rows ---------- */
#paletteList{ display:grid; gap:10px; margin-top:12px; }
.palette-item{
  display:grid; align-items:center; gap:10px;
  grid-template-columns: 52px 140px minmax(160px,1fr) 64px auto;
  background: #0f1b36;
  border: 1px solid var(--card-b);
  border-radius: 12px;
  padding: 8px;
}
.palette-item .col{ width: 48px; height: 38px; }
.palette-item .hex{ min-width: 132px; }
.palette-item .tol{ width: 100%; }
.palette-item .tolv{
  color: var(--text-2);
  width: 60px; text-align:right; font-variant-numeric: tabular-nums;
}
.palette-item .remove{ justify-self:end; }

/* ---------- Saved Palettes ---------- */
#savedPalettes .item{
  display:flex; justify-content:space-between; align-items:center;
  padding: 10px;
  border: 1px solid var(--card-b);
  border-radius: 12px; margin: 8px 0;
  background: #0f1b36; cursor:pointer;
}
#savedPalettes .item:hover{ background:#122143; }

/* ---------- Restricted Palette ---------- */
#restrictedList{
  display:grid; grid-template-columns: repeat(auto-fill, minmax(230px,1fr));
  gap: 10px; margin-top:10px;
}
#restrictedList .rp-item{
  display:flex; align-items:center; gap:10px;
  padding: 10px; border:1px solid var(--card-b);
  border-radius: 12px; background:#0f1b36;
}
#restrictedList input[type="checkbox"]{ width:18px; height:18px; }
#missingMixes{
  padding: 6px 10px; border-radius: 999px;
  background: #152243; border: 1px solid var(--card-b);
  color: var(--text-2);
}
#missingMixes:empty{ display:none; }

/* ---------- Canvases ---------- */
#srcCanvas, #outCanvas{
  display:block; width: 100%;
  max-height: 64vh;
  background: #0b172e;
  border: 1px solid var(--card-b);
  border-radius: 12px;
}
@media (min-width: 860px){
  #srcCanvas, #outCanvas{ max-height: 74vh; }
}

/* ---------- Rules table ---------- */
table{ border-collapse: collapse; width:100%; }
#rulesTable thead th{
  background: #122143;
  color: var(--text-2);
  padding: 10px 8px;
  border-bottom: 1px solid var(--card-b);
  font-weight: 700;
}
#rulesTable td{
  border-bottom: 1px solid #1b2a4a;
  padding: 8px 6px;
  vertical-align: middle;
}
#rulesTable tr:nth-child(even) td{
  background: #0e1832;
}
#rulesTable .inkchip{
  display:inline-flex; align-items:center; gap:6px; margin-right:6px;
}
#rulesTable .r-del.danger{
  background: #2a1620; border-color:#5a2033;
  color:#ffb4c1;
}
#rulesTable .r-del.danger:hover{ background:#3a1b29; }

/* ---------- Projects Drawer ---------- */
.projects{
  position:fixed; top:0; right:0; bottom:0; width:min(440px, 92vw);
  background: linear-gradient(180deg, #0f1b35, #0a1224);
  border-left: 1px solid var(--card-b);
  transform: translateX(100%);
  transition: transform .25s ease;
  z-index: 9999;
  display:flex; flex-direction:column;
  color: var(--text);
}
.projects.open{ transform: translateX(0); }
.projects[aria-hidden="true"]{ pointer-events:none; }
.projects-head{
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px; border-bottom: 1px solid var(--card-b);
}
.projects-actions{
  display:flex; flex-wrap:wrap; gap:8px; padding: 12px 14px;
  border-bottom: 1px solid var(--card-b);
}
.projects-list{ padding: 12px 14px; overflow:auto; flex:1; }
.projects-list .item{
  display:flex; justify-content:space-between; align-items:center;
  padding: 10px; border:1px solid var(--card-b);
  border-radius: 12px; margin-bottom: 10px;
  background:#0f1a33; cursor:pointer;
}
.projects-list .item.selected{ outline: 2px solid var(--brand); }
.projects-list .item .btn{ padding:8px 12px; }

/* ---------- Full-screen Editor ---------- */
#editorOverlay.hidden{ display:none; }
#editorOverlay{
  position:fixed; inset:0;
  background: rgba(6,10,20,.78);
  backdrop-filter: blur(7px);
  z-index: 9998;
}
.editor-toolbar{
  position:absolute; left:0; right:0; top:0;
  display:flex; align-items:center; gap:8px; flex-wrap:wrap;
  padding: 8px; background: rgba(10,16,30,.85);
  border-bottom: 1px solid var(--card-b);
}
#editCanvas, #editOverlay{
  position:absolute; left:0; right:320px; top:48px; bottom:0;
  width:auto; height:auto;
}
#editOverlay{ pointer-events:none; }

.editor-right{
  position:absolute; top:48px; right:0; width:min(320px, 88vw); bottom:0;
  border-left: 1px solid var(--card-b);
  background: rgba(10,16,30,.85);
  padding: 12px; overflow:auto;
}
.inline-swatches{ display:flex; flex-wrap:wrap; gap:6px; }
.inline-swatches .sw{ width:20px; height:20px; border:1px solid var(--sw-outline); border-radius:5px; }
.chips{ display:flex; flex-direction:column; gap:8px; }
.chips .lasso-ink{ display:flex; align-items:center; gap:8px; color: var(--text); }

/* ---------- Toast host (created by JS) ---------- */
#toasts{ padding: 0 8px; }
#toasts > div{
  color:#eef4ff;
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
}

/* ---------- Details summary (advanced mapping) ---------- */
details{
  border-radius: 10px;
  background: #0f1b36;
  border: 1px solid var(--card-b);
}
details[open]{ box-shadow: var(--inner); }
details > summary{
  cursor:pointer; list-style:none; padding:10px 12px;
  font-weight: 700; color: var(--text);
  border-bottom: 1px solid var(--card-b);
}
details > summary::-webkit-details-marker{ display:none; }
details > *:not(summary){ padding: 10px 12px; }

/* ---------- Accessibility & Focus ---------- */
:focus-visible{
  outline: 3px solid color-mix(in srgb, var(--focus) 70%, white 10%);
  outline-offset: 2px;
}
::selection{ background: color-mix(in srgb, var(--brand) 35%, #ffffff 0%); color:#fff; }

/* ---------- Responsive tweaks ---------- */
@media (max-width: 560px){
  .palette-item{
    grid-template-columns: 48px minmax(120px,1fr);
    grid-row-gap: 8px;
  }
  .palette-item .tol,
  .palette-item .tolv,
  .palette-item .remove{
    grid-column: 1 / -1;
    justify-self: start;
  }
  input[type="range"]{ width: 100%; }
}

/* ---------- CSS fallback warning ---------- */
#cssWarning{
  display:none; background:#fde68a; color:#4a2800;
  border:1px solid #fbbf24; padding:12px 14px; border-radius:12px; margin:0 0 18px;
}

/* ------- Hide default file button (we use .picker) ------- */
input[type="file"]::-webkit-file-upload-button{ visibility: hidden; }
