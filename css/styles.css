/* ============================================================
   Palette Mapper — complete stylesheet
   - Dark-first design with light fallback via prefers-color-scheme
   - iPhone-friendly touch targets + safe-area insets
   - Strong focus-visible, responsive cards/panels
   - Crisp canvas scaling, elegant sliders, tables, chips
   ============================================================ */

/* ----------------------- Theme Tokens ----------------------- */
:root {
  /* Dark theme (default) */
  --bg: #0f172a;              /* slate-900 */
  --bg-grad-1: #13203f;
  --bg-grad-2: #0f172a;

  --panel-bg: #0b1225;
  --card: #131c31;
  --card-b: #24314f;

  --text: #e8ecf3;
  --muted: #a7b3c7;
  --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;

  --brand: #3b82f6;           /* blue-500 */
  --brand-600: #2563eb;
  --brand-700: #1d4ed8;

  --ghost: #1f2937;           /* gray-800 */
  --ghost-b: #374151;

  --danger: #ef4444;
  --danger-700: #b91c1c;

  --focus: #60a5fa;

  --radius: 14px;
  --radius-sm: 10px;

  --sw-outline: #334155;

  --shadow-1: 0 6px 18px rgba(0,0,0,.25);
  --shadow-2: 0 20px 50px rgba(0,0,0,.25);
  --ring-focus: 0 0 0 3px rgba(96,165,250,.35);

  --card-pad: clamp(14px, 2.5vw, 20px);
  --page-pad: clamp(14px, 3vw, 24px);

  color-scheme: dark;
}

/* Optional: light theme if the OS prefers it */
@media (prefers-color-scheme: light) {
  :root {
    --bg: #f4f7fb;
    --bg-grad-1: #f8fbff;
    --bg-grad-2: #eef2f9;

    --panel-bg: #fff;
    --card: #ffffff;
    --card-b: #dde5f1;

    --text: #0b1528;
    --muted: #4a5a73;

    --ghost: #e8edf5;
    --ghost-b: #cbd6e6;

    --sw-outline: #9fb2ce;

    --shadow-1: 0 6px 14px rgba(19, 35, 61, .08);
    --shadow-2: 0 24px 60px rgba(19, 35, 61, .12);

    color-scheme: light;
  }
}

/* ----------------------- Base / Reset ----------------------- */
* { box-sizing: border-box; }
html, body { height: 100%; }
html { -webkit-text-size-adjust: 100%; }
body {
  margin: 0;
  background:
    radial-gradient(1200px 1200px at 50% calc(-200px + env(safe-area-inset-top)),
    var(--bg-grad-1) 0%, var(--bg-grad-2) 45%) fixed;
  color: var(--text);
  font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial,
        "Apple Color Emoji","Segoe UI Emoji";
  padding-bottom: env(safe-area-inset-bottom);
}

a { color: var(--brand); text-decoration: none; }
a:hover { text-decoration: underline; }
.mono { font-family: var(--mono); }

h1,h2,h3 { margin: 0 0 10px; line-height: 1.2; }
h1 { font-size: clamp(26px, 3vw, 32px); }
h2 { font-size: clamp(20px, 2.2vw, 22px); }
h3 { font-size: 16px; color: var(--muted); font-weight: 600; }

/* ----------------------- Layout ----------------------- */
header {
  display:flex; align-items:center; justify-content:space-between;
  padding: 22px var(--page-pad) calc(10px + env(safe-area-inset-top));
}
header p { margin: 6px 0 0; color: var(--muted); }

main { padding: 0 var(--page-pad) 28px; }
.row { display:flex; align-items:center; gap:10px; flex-wrap: wrap; }
.row .grow { flex:1; }
.help { color: var(--muted); margin: 10px 0; }

/* ----------------------- Cards / Panels ----------------------- */
.card {
  background: linear-gradient(180deg, color-mix(in srgb, var(--card) 60%, transparent), var(--bg));
  border: 1px solid var(--card-b);
  border-radius: var(--radius);
  padding: var(--card-pad);
  margin: 0 auto 18px;
  box-shadow: var(--shadow-2), inset 0 1px 0 rgba(255,255,255,.02);
}

.panel {
  margin-top: 10px;
  padding: 8px;
  background: color-mix(in srgb, var(--panel-bg) 92%, transparent);
  border: 1px solid color-mix(in srgb, var(--card-b) 85%, transparent);
  border-radius: var(--radius-sm);
}
.panel-head {
  margin: -6px -6px 8px -6px;
  padding: 10px 12px;
  background: color-mix(in srgb, var(--panel-bg) 98%, transparent);
  border-radius: 10px;
  border: 1px solid color-mix(in srgb, var(--card-b) 90%, transparent);
  font-weight: 700;
}

/* Constrain very tall inner panels to avoid layout jump */
.panel {
  max-height: 70vh;
  overflow: auto;
}

/* ----------------------- Buttons ----------------------- */
.btn {
  appearance: none;
  border: 1px solid transparent;
  background: var(--brand);
  color: #fff;
  padding: 12px 16px;                     /* comfy touch target */
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: transform .02s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
  box-shadow: 0 6px 18px rgba(59,130,246,.18);
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  min-height: 42px;
}
.btn:hover { background: var(--brand-600); }
.btn:active { transform: translateY(1px); }
.btn[disabled] { opacity:.5; cursor:not-allowed; box-shadow:none; }

.btn-ghost {
  background: var(--ghost);
  color: var(--text);
  border-color: var(--ghost-b);
  box-shadow: none;
}
.btn-ghost:hover { background: color-mix(in srgb, var(--ghost) 90%, #000 10%); }

.btn-danger {
  background: var(--danger);
  border-color: var(--danger);
  box-shadow: 0 6px 18px rgba(239,68,68,.18);
}
.btn-danger:hover { background: var(--danger-700); }

/* File/camera "label as button" pickers */
.picker { position: relative; display: inline-flex; align-items: center; justify-content: center; overflow: hidden; }
.picker input[type="file"] {
  position: absolute; inset: 0; opacity: 0; appearance: none; border: 0; margin: 0; padding: 0; cursor: pointer;
}

/* Strong keyboard focus */
:where(.btn, input, select, textarea, a):focus-visible {
  outline: 3px solid rgba(96,165,250,.7);
  outline-offset: 2px;
}
.btn:focus-visible { box-shadow: var(--ring-focus), 0 6px 18px rgba(59,130,246,.18); }

/* ----------------------- Forms ----------------------- */
input[type="number"],
input[type="text"],
select {
  background: #0e1a33;
  color: var(--text);
  border: 1px solid #2a3a5e;
  border-radius: 10px;
  padding: 10px 12px;
  min-width: 80px;
  outline: none;
}
input::placeholder { color: color-mix(in srgb, var(--muted) 65%, transparent); }
input[type="number"]:focus,
input[type="text"]:focus,
select:focus { border-color: var(--focus); box-shadow: 0 0 0 3px rgba(96,165,250,.2); }

.kv { display:flex; align-items:center; gap:10px; }
.kv .key { color: var(--muted); }
input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--brand); }

/* Sliders — large, thumb-friendly */
input[type="range"]{
  -webkit-appearance:none; width:min(280px, 42vw); height: 28px; background: transparent;
}
input[type="range"]::-webkit-slider-runnable-track{
  height:8px; background:#223352; border-radius:5px; border:1px solid #2a3a5e;
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none; margin-top:-8px;
  width:22px; height:22px; border-radius:50%;
  background: var(--brand);
  border: 2px solid #dbeafe;
  box-shadow: 0 2px 6px rgba(59,130,246,.5);
}
input[type="range"]::-moz-range-track{
  height:8px; background:#223352; border-radius:5px; border:1px solid #2a3a5e;
}
input[type="range"]::-moz-range-thumb{
  width:20px; height:20px; border-radius:50%; background: var(--brand); border:2px solid #dbeafe;
}

/* ----------------------- Palette Builder ----------------------- */
#paletteList { display:grid; gap:8px; margin-top:10px; }
.palette-item {
  display:grid; align-items:center; gap:8px;
  grid-template-columns: 44px 120px 1fr auto auto;
}
.palette-item .col {
  width: 44px; height: 34px; padding:0;
  border:1px solid var(--sw-outline); border-radius:8px; background:#0e1a33;
}
.palette-item .hex { min-width: 110px; }
.palette-item .tol { width: 100%; }
.palette-item .tolv { color: var(--muted); width: 48px; text-align:right; }
.palette-item .remove { justify-self: end; }
.chip { display:inline-block; width:18px; height:18px; border-radius: 6px; border:1px solid var(--sw-outline); }

/* Saved palettes */
#savedPalettes .item {
  display:flex; justify-content:space-between; align-items:center;
  padding: 8px; border:1px solid #233252; border-radius:10px; margin: 6px 0;
  background:#0f1a33; cursor:pointer;
}
#savedPalettes .item:hover { background:#13203f; }

/* ----------------------- Restricted Palette ----------------------- */
#restrictedList {
  display:grid; grid-template-columns: repeat(auto-fill, minmax(210px,1fr));
  gap: 8px; margin-top:10px;
}
#restrictedList .rp-item{
  display:flex; align-items:center; gap:8px;
  padding:8px; border:1px solid #223252; border-radius:10px; background:#0f1a33;
}
#restrictedList input[type="checkbox"]{ width:18px; height:18px; }

/* ----------------------- Canvases ----------------------- */
#srcCanvas, #outCanvas {
  display:block;
  width: 100%;
  max-height: 60vh;
  background: #0b172e;
  border: 1px solid #223252;
  border-radius: 12px;
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges; /* Firefox */
}

/* ----------------------- Rules table ----------------------- */
table { border-collapse: collapse; width: 100%; }
#rulesTable {
  display: block;               /* enables horizontal scroll on small screens */
  overflow-x: auto;
  white-space: nowrap;
  border: 1px solid #1e2a44;
  border-radius: 10px;
}
#rulesTable th, #rulesTable td {
  border-bottom: 1px solid #1e2a44;
  padding: 8px 6px;
  text-align: left;
  vertical-align: middle;
}
#rulesTable thead th { color: var(--muted); font-weight: 600; }
#rulesTable .inkchip { display:inline-flex; align-items:center; gap:6px; margin-right: 6px; }

/* ----------------------- Code list / report ----------------------- */
.code-list .row { margin: 4px 0; padding: 2px 0; }
.report-footer { margin-top: 8px; color: var(--muted); font-size: 13px; }

/* ----------------------- Projects Drawer ----------------------- */
.projects {
  position: fixed; inset: 0 0 0 auto; width:min(420px, 92vw);
  background: linear-gradient(180deg, color-mix(in srgb, var(--panel-bg) 96%, transparent), var(--bg));
  border-left: 1px solid #2a3656;
  transform: translateX(100%);
  transition: transform .25s ease;
  z-index: 9999;
  display:flex; flex-direction:column;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}
.projects.open { transform: translateX(0); }
.projects[aria-hidden="true"] { pointer-events:none; }

.projects-head {
  display:flex; align-items:center; justify-content:space-between;
  padding: 14px 14px;
  border-bottom: 1px solid #243252;
}
.projects-actions {
  display:flex; flex-wrap:wrap; gap:8px; padding: 12px 14px;
  border-bottom: 1px solid #243252;
}
.projects-list { padding: 12px 14px; overflow:auto; flex:1; }
.projects-list .item {
  display:flex; justify-content:space-between; align-items:center;
  padding: 10px; border:1px solid #223252; border-radius: 12px; margin-bottom: 10px;
  background:#0f1a33; cursor:pointer;
}
.projects-list .item.selected { outline: 2px solid var(--brand); }
.projects-list .item .btn { padding:8px 12px; }

/* ----------------------- Full-screen Editor ----------------------- */
#editorOverlay.hidden { display:none; }
#editorOverlay {
  position: fixed; inset: 0; background: rgba(6,10,20,.85);
  backdrop-filter: blur(6px);
  z-index: 9998;
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

.editor-toolbar {
  position: absolute; left:0; right:0; top:0;
  display:flex; align-items:center; gap:8px;
  padding: 8px env(safe-area-inset-left) 8px calc(8px + env(safe-area-inset-right));
  background: rgba(10,16,30,.75);
  border-bottom: 1px solid #233252;
}
#editCanvas, #editOverlay {
  position: absolute; left:0; right:320px; top:48px; bottom:0;
  width: auto; height: auto;
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
}
#editOverlay { pointer-events:none; }

.editor-right {
  position: absolute; top:48px; right:0; width: min(320px, 88vw); bottom:0;
  border-left: 1px solid #233252;
  background: rgba(10,16,30,.78);
  padding: 12px;
  overflow:auto;
}
.inline-swatches { display:flex; flex-wrap:wrap; gap:6px; }
.inline-swatches .sw { width:20px; height:20px; border:1px solid var(--sw-outline); border-radius:5px; }

.chips { display:flex; flex-direction:column; gap:8px; }
.chips .lasso-ink { display:flex; align-items:center; gap:8px; }

/* ----------------------- Toasts ----------------------- */
#toasts { padding: 0 8px; }
#toasts > div {
  background:#111826cc; border:1px solid #2a3243; color:#e8ecf3;
  padding:10px 12px; border-radius:10px; backdrop-filter:blur(8px);
  max-width:min(92vw,560px); box-shadow: var(--shadow-1);
}

/* ----------------------- Utilities ----------------------- */
.hidden { display:none !important; }
hr { border: 0; border-top: 1px solid var(--card-b); margin: 12px 0; }

/* Prevent long press callout on iOS for canvases/buttons */
canvas, .btn { -webkit-touch-callout: none; }

/* Hide default file input button (we click label instead) */
input[type="file"]::-webkit-file-upload-button { visibility: hidden; }

/* ----------------------- Responsive Tweaks ----------------------- */
@media (min-width: 860px) {
  .panel { padding: 12px; }
  #srcCanvas, #outCanvas { max-height: 70vh; }
  input[type="range"]{ width: 320px; }
}

/* Stack “Map + controls” row more compactly on very narrow screens */
@media (max-width: 420px) {
  #weightsRow .kv { width: 100%; justify-content: space-between; }
  input[type="range"]{ width: 100%; }
}

/* ----------------------- Motion & Accessibility ----------------------- */
@media (prefers-reduced-motion: reduce) {
  .btn, .projects { transition: none !important; }
  * { scroll-behavior: auto !important; }
}

/* ----------------------- Print (Report) ----------------------- */
@media print {
  body { background: #fff; color: #000; }
  header, .projects, #editorOverlay, #toasts { display:none !important; }
  .card, .panel { box-shadow: none; border: 1px solid #bbb; background: #fff; color: #000; }
  .btn { display:none; }
  .code-list, .report-footer { color: #000; }
}
